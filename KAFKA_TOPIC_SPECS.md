# Kafka Topic Specifications

## Raw Trades Topic

### Topic Configuration
- **Topic Name**: `crypto-raw-trades`
- **Partitions**: 3
- **Replication Factor**: 1
- **Key**: Symbol (e.g., "BTCUSDT", "ETHUSDT", "BNBUSDT")
- **Value**: Trade object (JSON)

### Message Format
The raw trades topic receives real-time trade data from Binance WebSocket. Each message is a JSON object with the following structure:

```json
{
  "e": "trade",           // Event type (always "trade" for trade events)
  "E": 1638360000000,     // Event time (Unix timestamp in milliseconds)
  "s": "BTCUSDT",         // Symbol
  "t": 123456789,         // Trade ID (unique identifier)
  "p": "45123.50",        // Price (as string/BigDecimal)
  "q": "0.01234",         // Quantity (as string/BigDecimal)
  "b": 88888888,          // Buyer order ID
  "a": 99999999,          // Seller order ID
  "T": 1638360000123,     // Trade time (Unix timestamp in milliseconds)
  "m": true               // Is buyer the maker? (true = sell order, false = buy order)
}
```

### Field Descriptions
- **eventType**: Always "trade" for trade events
- **eventTime**: When the event was generated by Binance
- **symbol**: Trading pair (e.g., BTCUSDT = Bitcoin/USDT)
- **tradeId**: Unique identifier for this trade
- **price**: Trade execution price
- **quantity**: Amount of cryptocurrency traded
- **buyerOrderId**: Order ID of the buyer
- **sellerOrderId**: Order ID of the seller
- **tradeTime**: Actual trade execution time
- **isBuyerMaker**: 
  - `true` = Buyer was the maker (placed limit order first), so this is a market sell
  - `false` = Seller was the maker, so this is a market buy

### Connecting to the Topic

#### Java/Spring Boot Example
```java
@KafkaListener(topics = "crypto-raw-trades", groupId = "my-consumer-group")
public void consumeTrade(Trade trade) {
    System.out.println("Received trade: " + trade.getSymbol() + " @ " + trade.getPrice());
}
```

#### Python Example
```python
from kafka import KafkaConsumer
import json

consumer = KafkaConsumer(
    'crypto-raw-trades',
    bootstrap_servers=['localhost:9092'],
    value_deserializer=lambda m: json.loads(m.decode('utf-8')),
    group_id='my-consumer-group'
)

for message in consumer:
    trade = message.value
    print(f"Trade: {trade['s']} @ {trade['p']}")
```

#### Node.js Example
```javascript
const { Kafka } = require('kafkajs')

const kafka = new Kafka({
  clientId: 'my-app',
  brokers: ['localhost:9092']
})

const consumer = kafka.consumer({ groupId: 'my-consumer-group' })

async function run() {
  await consumer.connect()
  await consumer.subscribe({ topic: 'crypto-raw-trades', fromBeginning: false })
  
  await consumer.run({
    eachMessage: async ({ topic, partition, message }) => {
      const trade = JSON.parse(message.value.toString())
      console.log(`Trade: ${trade.s} @ ${trade.p}`)
    },
  })
}

run()
```

### Additional Notes
1. **Data Rate**: Expect high frequency data, especially for BTCUSDT (multiple trades per second)
2. **Ordering**: Messages are ordered per partition (keyed by symbol)
3. **Serialization**: JSON format with Spring Kafka JsonSerializer
4. **Volume Calculation**: Volume in USD = price Ã— quantity
5. **Timestamp**: Use `tradeTime` (field "T") for accurate trade timing

### Kafka Connection Settings
- **Bootstrap Servers**: `localhost:9092`
- **Key Deserializer**: `StringDeserializer`
- **Value Deserializer**: `JsonDeserializer` (configure trusted packages for Trade class)
- **Consumer Group**: Use your own unique group ID

### Available Symbols
The application subscribes to these symbols by default:
- BTCUSDT (Bitcoin/USDT)
- ETHUSDT (Ethereum/USDT)
- BNBUSDT (Binance Coin/USDT)